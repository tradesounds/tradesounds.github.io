<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <title>Invoice Generator - TRADESOUNDS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      background: #FFFFFF !important;
      color: #000000 !important;
    }

    /* Dark mode (hanya di layar) */
    body.dark-mode {
      background: #121212 !important;
      color: #FFFFFF !important;
    }

    body.dark-mode #invoiceBox {
      background: #1E1E1E !important;
      color: #FFFFFF !important;
    }

    body.dark-mode table {
      color: #FFFFFF !important;
    }

    body.dark-mode input,
    body.dark-mode textarea {
      color: #FFFFFF !important;
    }

    #invoiceBox {
      background: #FFFFFF;
      padding: 20px;
      border-radius: 8px;
      max-width: 900px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    /* Input transparan */
    input,
    textarea {
      background: transparent;
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      color: inherit;
      width: 100%;
    }

    input::placeholder,
    textarea::placeholder {
      color: #aaa;
      opacity: 1;
    }

    /* Gambar produk */
    .product-img {
      max-height: 40px;
      display: block;
      margin: auto;
    }

    /* Responsive table */
    @media (max-width: 768px) {
      #invoiceBox table {
        font-size: 12px;
      }

      #invoiceBox h2 {
        font-size: 20px;
      }
    }

    /* Cetak / PDF selalu pakai mode terang */
    @media print {
      body.dark-mode {
        background: #FFFFFF !important;
        color: #000000 !important;
      }

      body.dark-mode #invoiceBox {
        background: #FFFFFF !important;
        color: #000000 !important;
      }

      body.dark-mode table,
      body.dark-mode input,
      body.dark-mode textarea {
        color: #000000 !important;
      }

      body * {
        visibility: hidden;
      }

      #invoiceBox,
      #invoiceBox * {
        visibility: visible;
      }

      #invoiceBox {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }

      input[type="file"] {
        display: none !important;
      }
    }
  </style>
</head>

<body>
  <div class="container my-4">
    <div class="row g-3">
      <!-- Form -->
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="mb-3">Form Input Invoice</h5>

            <div class="mb-3">
              <label class="form-label">Nama Brand:</label>
              <input type="text" id="brandInput" placeholder="Masukkan nama brand" />
            </div>

            <div class="mb-3">
              <label class="form-label">Logo Brand:</label>
              <input type="file" id="logoInput" accept="image/*" />
            </div>

            <div class="mb-3">
              <label class="form-label">Bill To:</label>
              <input type="text" id="billToInput" placeholder="Nama klien" />
            </div>

            <div class="mb-3">
              <label class="form-label">Due Date:</label>
              <input type="date" id="dueDateInput" />
            </div>

            <!-- Tombol Aksi -->
            <div class="d-flex flex-wrap gap-2 mt-3">
              <button class="btn btn-primary btn-sm" onclick="addItem()">‚ûï Tambah Produk</button>
              <button class="btn btn-success btn-sm" onclick="generatePDF()">‚¨áÔ∏è Download PDF</button>
              <button class="btn btn-secondary btn-sm" onclick="window.print()">üñ®Ô∏è Print</button>
              <button class="btn btn-dark btn-sm" onclick="toggleDarkMode()">üåô Dark Mode</button>
              <button class="btn btn-danger btn-sm" onclick="clearData()">‚ôªÔ∏è Reset Data</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Invoice -->
      <div class="col-md-8">
        <div id="invoiceBox">
          <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
            <h2 id="brandName">TRADESOUNDS</h2>
            <img id="brandLogo" src="" alt="Logo" style="max-height: 60px; display:none;" />
          </div>

          <div class="mb-3">
            <strong>Bill To:</strong> <span id="billToText"></span><br>
            <strong>Due Date:</strong> <span id="dueDateText"></span><br>
            <strong>Invoice :</strong> <span id="invoiceNumberText"></span>
          </div>

          <div class="table-responsive">
            <table class="table table-bordered align-middle text-center">
              <thead>
                <tr>
                  <th>Gambar</th>
                  <th>Deskripsi</th>
                  <th>Qty</th>
                  <th>Harga</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="invoiceItems"></tbody>
              <tfoot>
                <tr>
                  <th colspan="4" class="text-end">Grand Total</th>
                  <th id="grandTotal">0.00</th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function generateInvoiceNumber() {
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2, "0");
      const d = String(today.getDate()).padStart(2, "0");
      const rand = String(Math.floor(Math.random() * 999) + 1).padStart(3, "0");
      return `INV-${y}${m}${d}-${rand}`;
    }

    function formatNumber(num) {
      return Number(num).toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function addItem() {
      const tbody = document.getElementById("invoiceItems");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>
          <input type="file" accept="image/*" onchange="previewProductImage(this)" />
          <img class="product-img" style="display:none;" />
        </td>
        <td><input type="text" placeholder="Deskripsi"></td>
        <td><input type="number" step="0.01" value="1" onchange="updateTotal()"></td>
        <td><input type="number" step="0.01" value="0" onchange="updateTotal()"></td>
        <td class="itemTotal">0.00</td>
      `;
      tbody.appendChild(row);
    }

    function previewProductImage(input) {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          const img = input.parentNode.querySelector(".product-img");
          img.src = e.target.result;
          img.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    }

    function updateTotal() {
      let grandTotal = 0;
      document.querySelectorAll("#invoiceItems tr").forEach(row => {
        const qty = parseFloat(row.cells[2].querySelector("input").value) || 0;
        const price = parseFloat(row.cells[3].querySelector("input").value) || 0;
        const total = qty * price;
        row.querySelector(".itemTotal").textContent = formatNumber(total);
        grandTotal += total;
      });
      document.getElementById("grandTotal").textContent = formatNumber(grandTotal);
    }

    function generatePDF() {
      const element = document.getElementById("invoiceBox");
      const billTo = document.getElementById("billToInput").value.trim() || "UNKNOWN";
      const safeBillTo = billTo.replace(/[^a-z0-9]/gi, "_");
      const fileName = `INV-TRD-${safeBillTo}.pdf`;

      // ‚úÖ sementara matikan dark-mode agar PDF tetap terang
      const wasDark = document.body.classList.contains("dark-mode");
      if (wasDark) document.body.classList.remove("dark-mode");

      html2pdf().from(element).save(fileName).then(() => {
        if (wasDark) document.body.classList.add("dark-mode");
      });
    }

    function clearData() {
      document.getElementById("brandInput").value = "";
      document.getElementById("billToInput").value = "";
      document.getElementById("dueDateInput").value = "";
      document.getElementById("brandName").textContent = "TRADESOUNDS";
      document.getElementById("brandLogo").style.display = "none";
      document.getElementById("billToText").textContent = "";
      document.getElementById("dueDateText").textContent = "";
      document.getElementById("invoiceNumberText").textContent = generateInvoiceNumber();
      document.getElementById("invoiceItems").innerHTML = "";
      document.getElementById("grandTotal").textContent = "0.00";
    }

    // Sinkronisasi input header
    document.getElementById("brandInput").addEventListener("input", e => {
      document.getElementById("brandName").textContent = e.target.value || "TRADESOUNDS";
    });

    document.getElementById("logoInput").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          document.getElementById("brandLogo").src = ev.target.result;
          document.getElementById("brandLogo").style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("billToInput").addEventListener("input", e => {
      document.getElementById("billToText").textContent = e.target.value;
    });

    document.getElementById("dueDateInput").addEventListener("input", e => {
      document.getElementById("dueDateText").textContent = e.target.value;
    });

    // set invoice number otomatis saat load
    document.getElementById("invoiceNumberText").textContent = generateInvoiceNumber();
  </script>
</body>
</html>
