<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <title>Invoice Generator - TRADESOUNDS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      background: #f8f9fa;
      font-family: Arial, sans-serif;
    }

    .invoice-container {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    h2 {
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table th,
    table td {
      border: 1px solid #000 !important;
      text-align: center;
      vertical-align: middle;
    }

    /* ✅ Input default */
    input,
    textarea {
      border: none;
      outline: none;
      width: 100%;
      background: transparent;
    }

    input:focus,
    textarea:focus {
      border: 1px solid #0d6efd;
      border-radius: 4px;
      background: #fff;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6c757d;
      opacity: 1;
    }

    /* ✅ Dark Mode */
    body.dark-mode {
      background: #212529;
      color: #f8f9fa;
    }

    body.dark-mode .invoice-container {
      background: #2c3034;
      color: #f8f9fa;
    }

    body.dark-mode input,
    body.dark-mode textarea {
      color: #ffffff !important;
      background: transparent !important;
    }

    body.dark-mode input::placeholder,
    body.dark-mode textarea::placeholder {
      color: #aaa !important;
    }

    /* ✅ Gambar produk */
    .product-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border: 1px solid #000;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="container my-4">
    <div class="invoice-container" id="invoice">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>INVOICE</h2>
        <div>
          <strong>TRADESOUNDS</strong><br />
          <small><input type="text" placeholder="Alamat" /></small>
        </div>
      </div>

      <!-- Info -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label><strong>Kepada:</strong></label>
          <input type="text" placeholder="Nama Pelanggan" />
          <textarea rows="2" placeholder="Alamat Pelanggan"></textarea>
        </div>
        <div class="col-md-6 text-md-end">
          <label><strong>Tanggal:</strong></label>
          <input type="date" /><br />
          <label><strong>No Invoice:</strong></label>
          <input type="text" placeholder="INV-001" />
        </div>
      </div>

      <!-- Tabel Produk -->
      <table class="table table-bordered align-middle" id="invoiceTable">
        <thead class="table-light">
          <tr>
            <th>Produk</th>
            <th>Gambar</th>
            <th>Qty</th>
            <th>Harga</th>
            <th>Total</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" placeholder="Nama Produk" /></td>
            <td>
              <label class="btn btn-outline-primary btn-sm w-100">
                Upload Gambar
                <input type="file" accept="image/*" onchange="previewProductImage(this)" hidden />
              </label>
              <img class="product-img mt-1" style="display:none;" />
            </td>
            <td><input type="number" value="1" onchange="updateTotal(this)" /></td>
            <td><input type="number" value="0" onchange="updateTotal(this)" /></td>
            <td class="item-total">0</td>
            <td><button class="btn btn-danger btn-sm" onclick="removeRow(this)">Hapus</button></td>
          </tr>
        </tbody>
      </table>

      <button class="btn btn-primary btn-sm my-2" onclick="addItem()">Tambah Produk</button>

      <!-- Total -->
      <div class="text-end mt-3">
        <h5>Total: Rp <span id="grandTotal">0</span></h5>
      </div>
    </div>

    <!-- Tombol Aksi -->
    <div class="mt-3 d-flex justify-content-center flex-wrap gap-2">
      <button class="btn btn-success" onclick="generatePDF()">Download PDF</button>
      <button class="btn btn-secondary" onclick="window.print()">Print</button>
      <button class="btn btn-dark" onclick="toggleDarkMode()">Dark Mode</button>
    </div>
  </div>

  <script>
    function addItem() {
      let table = document.getElementById("invoiceTable").getElementsByTagName("tbody")[0];
      let row = table.insertRow();
      row.innerHTML = `
        <td><input type="text" placeholder="Nama Produk" /></td>
        <td>
          <label class="btn btn-outline-primary btn-sm w-100">
            Upload Gambar
            <input type="file" accept="image/*" onchange="previewProductImage(this)" hidden />
          </label>
          <img class="product-img mt-1" style="display:none;" />
        </td>
        <td><input type="number" value="1" onchange="updateTotal(this)" /></td>
        <td><input type="number" value="0" onchange="updateTotal(this)" /></td>
        <td class="item-total">0</td>
        <td><button class="btn btn-danger btn-sm" onclick="removeRow(this)">Hapus</button></td>
      `;
    }

    function removeRow(button) {
      let row = button.closest("tr");
      row.remove();
      calculateGrandTotal();
    }

    function updateTotal(input) {
      let row = input.closest("tr");
      let qty = row.querySelector('td:nth-child(3) input').value;
      let price = row.querySelector('td:nth-child(4) input').value;
      let total = qty * price;
      row.querySelector(".item-total").innerText = total;
      calculateGrandTotal();
    }

    function calculateGrandTotal() {
      let totals = document.querySelectorAll(".item-total");
      let grandTotal = 0;
      totals.forEach(cell => {
        grandTotal += parseFloat(cell.innerText) || 0;
      });
      document.getElementById("grandTotal").innerText = grandTotal;
    }

    function previewProductImage(input) {
      let file = input.files[0];
      if (file) {
        let reader = new FileReader();
        reader.onload = function (e) {
          let img = input.closest("td").querySelector(".product-img");
          img.src = e.target.result;
          img.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    }

    function generatePDF() {
      let element = document.getElementById("invoice");
      let opt = {
        margin: 0.5,
        filename: 'invoice.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().from(element).set(opt).save();
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>
